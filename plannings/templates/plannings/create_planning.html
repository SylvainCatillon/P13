{% extends 'core/base.html' %}
{% block content %}
  <p>Hello world</p>
  <form id="planning_form" method="post" action="{% url 'plannings:create' %}">{% csrf_token %}
    {{ form.as_p }}
  </form>
  <select id="guests_email_select" multiple></select>
  <form id="guest_emails_form">
  <label for="guest_email">Ajouter un Email</label>
  <input type="email" id="guest_email" name="guest_email">
  <input type="submit" value="Ajouter">
  </form>
  <input type="submit" form="planning_form" value="Envoyer">
{% endblock %}
{% block js %}
  {{ block.super }}
  <script type="text/javascript">
  $(function () {
      const planning_form = $('#planning_form')

      $('#guest_emails_form').on('submit', function (event) {
          event.preventDefault()
          event.stopPropagation()
          let $form = $(this),
              data = $form.serializeArray(),
              email = data.reduce(function(obj, item) { obj[item.name] = item.value; return obj;}, {} )['guest_email']
          $('#guests_email_select').append($('<option></option>', {value: email, text: email}))
          planning_form.append($('<input>', {value: email, hidden: true, name: 'guest_email'}))
          $form.trigger('reset')

      })

      planning_form.on('submit', function (event) {
        let $form = $( this ),
          data = $form.serialize(),
          url = $form.attr("action");

        $.post(url, data);

      })
  })
  </script>
{%  endblock %}